---
import { getCollection } from 'astro:content';
import BaseHead from '../../../components/BaseHead.astro';
import Footer from '../../../components/Footer.astro';
import Header from '../../../components/Header.astro';
import { SITE_TITLE } from '../../../consts';

const categoryInfo: Record<string, { name: string; description: string }> = {
	'plats-principaux': {
		name: 'Plats Principaux',
		description: 'Poulet, porc, boeuf et fruits de mer'
	},
	'desserts': {
		name: 'Desserts',
		description: 'Gâteaux, biscuits et sucreries'
	},
	'sauces-et-marinades': {
		name: 'Sauces et Marinades',
		description: 'Vinaigrettes, trempettes et marinades'
	},
	'accompagnements': {
		name: 'Accompagnements',
		description: 'Conserves et condiments maison'
	},
	'soupes': {
		name: 'Soupes',
		description: 'Potages et bouillons réconfortants'
	}
};

export async function getStaticPaths() {
	const categories = ['plats-principaux', 'desserts', 'sauces-et-marinades', 'accompagnements', 'soupes'];
	return categories.map((category) => ({
		params: { category },
	}));
}

const { category } = Astro.params;
const info = categoryInfo[category];
const recipes = await getCollection(category as any);
const sortedRecipes = recipes.sort((a, b) => a.data.title.localeCompare(b.data.title, 'fr'));
---

<!doctype html>
<html lang="fr">
	<head>
		<BaseHead title={`${info.name} | ${SITE_TITLE}`} description={info.description} />
		<style>
			.page-header {
				text-align: center;
				padding: 2rem 0 1rem;
			}

			.breadcrumb {
				font-size: 0.9rem;
				color: var(--text-muted);
				margin-bottom: 1rem;
			}

			.breadcrumb a {
				color: var(--text-muted);
				text-decoration: none;
			}

			.breadcrumb a:hover {
				color: var(--accent);
			}

			.page-header h1 {
				margin: 0 0 0.5rem;
				font-size: 2.2rem;
			}

			.page-header p {
				color: var(--text-muted);
				margin: 0;
				font-style: italic;
			}

			.divider {
				display: flex;
				align-items: center;
				justify-content: center;
				gap: 1rem;
				margin: 1.5rem 0 2rem;
				color: var(--accent);
			}

			.divider::before,
			.divider::after {
				content: '';
				width: 80px;
				height: 1px;
				background: var(--border);
			}

			.recipe-count {
				text-align: center;
				color: var(--text-muted);
				margin-bottom: 2rem;
				font-size: 0.95rem;
			}

			.recipe-list {
				list-style: none;
				padding: 0;
				margin: 0;
				display: flex;
				flex-direction: column;
				gap: 0.75rem;
			}

			.recipe-item {
				background: white;
				border-radius: 6px;
				border: 1px solid var(--border);
				transition: transform 0.15s ease, box-shadow 0.15s ease, border-color 0.15s ease;
			}

			.recipe-item:hover {
				transform: translateX(4px);
				box-shadow: var(--box-shadow);
				border-color: var(--accent-light);
			}

			.recipe-item a {
				text-decoration: none;
				display: block;
				padding: 1.25rem 1.5rem;
			}

			.recipe-title {
				font-family: 'Playfair Display', Georgia, serif;
				font-size: 1.15rem;
				font-weight: 600;
				color: var(--text);
				margin: 0 0 0.25rem;
			}

			.recipe-subtitle {
				color: var(--text-muted);
				font-size: 0.9rem;
				font-style: italic;
				margin: 0 0 0.5rem;
			}

			.recipe-meta {
				display: flex;
				gap: 1.25rem;
				font-size: 0.85rem;
				color: var(--text-muted);
			}

			.recipe-meta span {
				display: flex;
				align-items: center;
				gap: 0.35rem;
			}

			@media (max-width: 720px) {
				.page-header h1 {
					font-size: 1.8rem;
				}

				.recipe-item a {
					padding: 1rem 1.25rem;
				}

				.recipe-title {
					font-size: 1.05rem;
				}
			}
		</style>
	</head>
	<body>
		<Header />
		<main>
			<div class="page-header">
				<nav class="breadcrumb">
					<a href="/">Accueil</a> › {info.name}
				</nav>
				<h1>{info.name}</h1>
				<p>{info.description}</p>
			</div>

			<div class="divider">✦</div>

			<p class="recipe-count">{sortedRecipes.length} recettes</p>

			<ul class="recipe-list">
				{sortedRecipes.map((recipe) => (
					<li class="recipe-item">
						<a href={`/recettes/${category}/${recipe.id}/`}>
							<h2 class="recipe-title">{recipe.data.title}</h2>
							{recipe.data.titleEnglish && (
								<p class="recipe-subtitle">{recipe.data.titleEnglish}</p>
							)}
							<div class="recipe-meta">
								{recipe.data.prepTime && (
									<span>Prép: {recipe.data.prepTime}</span>
								)}
								{recipe.data.cookTime && (
									<span>Cuisson: {recipe.data.cookTime}</span>
								)}
							</div>
						</a>
					</li>
				))}
			</ul>
		</main>
		<Footer />
	</body>
</html>
